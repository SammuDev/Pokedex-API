import Head from "next/head";
import React, { useEffect, useState } from "react";
import PokeScrow from "../styles/styledsPokedex/PokeScrow";
import Link from "next/link";
import PokesmonsScrow from "../styles/styledsPokedex/PokesmonsScrow";
import Logo from "../styles/styledsHome/Logo";
import Paragraphy from "../styles/styledsPokedex/Paragraphy";
import InputSearch from "../styles/styledsPokedex/InputSearch";
import Card from "./Cards/Card";
import PokeData from "../styles/styledsPokedex/PokeData";
import MainCustom from "../styles/styledsPokedex/MainCustom";
import Image from "next/image";
import ButtonPokemons from "../styles/styledsPokedex/ButtonPokemons";

type PokeProps = {
  id: number;
  number: string;
  url: string;
  name: string;
  image: string;
  fetchedAt: string;
  search: string;
  attacks: {
    special: Array<{
      name: string;
      type: string;
      damage: number;
    }>
  }
};

const Pokedex = () => {
  const [data, setData] = useState<PokeProps[]>([]);
  const [filteredPokemons, setFilteredPokemons] = useState<PokeProps[]>([]);
  const [filteredImg, setFilteredImg] = useState(`https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${25}.png`);
  const [search, setSearch] = useState('');

  // ABAIxO: Requisição fething data dos Pokemons
  useEffect(() => {
    const getData = async () => {
      try {
        const maxPokemons = 100 // -> Quantidade de Pokemóns que podem ser visualizados!
        const url = 'https://pokeapi.co/api/v2/pokemon';

        const res = await fetch(`${url}/?limit=${maxPokemons}`);
        const pokemons = await res.json();
        console.log(pokemons.results);

        pokemons.results.forEach((obj: any, idx: number) => obj.id = idx + 1);

        setData(pokemons.results);
      }
      catch (e) {
        console.log(`Error: ${e}`);
      }
    };

    getData();
  }, []);

  //ABAIXO: Busca de Pokemons
  useEffect(() => {
    setFilteredPokemons(data.filter(poke => poke.name.includes(search.toLowerCase())));
  }, [data, search]);

  const handlePokemons = (id: any) => {
    setFilteredImg(() => `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${id}.png`);
    console.log(`BOTÃO ${id} FUNCIONANDO!`);
    console.log(`ID's: ${filteredImg}!`);
  };

  return (
    <div>
      <Head>
        <title>Dash - Pokedex</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <MainCustom>
        <PokesmonsScrow>
          {/* <Link href={'/'}>Home</Link> */}
          <Logo val/>

          <Paragraphy>Everything you wanted to know about<br /> your favorite pocket monster!</Paragraphy>

          <InputSearch value={search} onChange={e => setSearch(e.target.value)}/>

          <hr />

          <PokeScrow>
            {!search && data.map(poke => (
              <ButtonPokemons key={poke.id} onClick={() => handlePokemons(poke.id)}>
                #{poke.id < 10 ? `00${poke.id}` : poke.id < 100 ? `0${poke.id}` : `${poke.id}`} - {poke.name}
              </ButtonPokemons>
            ))}

            {/* =========== */}

            {search && filteredPokemons.map(poke => (
              <ButtonPokemons key={poke.name} onClick={() => handlePokemons(poke.id)}>
                #{poke.id < 10 ? `00${poke.id}` : poke.id < 100 ? `0${poke.id}` : `${poke.id}`} - {poke.name}
              </ButtonPokemons>
            ))}
          </PokeScrow>
        </PokesmonsScrow>

        <PokeData>
          <Image
            src={filteredImg}
            width={200}
            height={200}
            alt='Pokemom'/>
        </PokeData>
      </MainCustom>
    </div>
  );
};

export default Pokedex;
